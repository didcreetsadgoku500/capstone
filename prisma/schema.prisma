generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

model Staff {
  id     BigInt @id @default(autoincrement())
  userId Int
  tournamentId  BigInt
  role   String
  tournament   Tournament @relation(fields: [tournamentId], references: [tournamentId], onDelete: Cascade)

}

model Tournament {
  tournamentId  BigInt          @id @default(autoincrement())
  tourName      String
  tourDesc      String
  gamemode      Gamemode
  bannerUrl     String          @default("/strafeSmoke.jpg")
  maxRank       Int?
  minRank       Int?
  usesBWS       Boolean?
  public        Boolean         @default(false)
  registrations Registration[]
  stages        Stage[]
  staff         Staff[]
}

model Stage {
  tournamentId BigInt
  stageNo      Int        @default(sequence(maxValue: 2147483647))
  stageName    String
  isBracket    Boolean
  public       Boolean    @default(false)
  mappool      Mappool[]
  matches      Match[]
  tournament   Tournament @relation(fields: [tournamentId], references: [tournamentId], onDelete: Cascade)

  @@id([tournamentId, stageNo])
}

model Match {
  tournamentId  BigInt
  stageNo       Int
  matchId       Int         @default(sequence())
  team1Score    Int         @default(0)
  team2Score    Int         @default(0)
  team1Id       String?
  team2Id       String?
  matchStatus   MatchStatus
  matchDateTime DateTime?
  referee       String?
  stage         Stage       @relation(fields: [tournamentId, stageNo], references: [tournamentId, stageNo], onDelete: Cascade)

  @@id([tournamentId, matchId])
}

model Mappool {
  mappoolItemId BigInt @id @default(autoincrement())
  tournamentId  BigInt
  stageNo       Int
  mapId         Int?
  mods          String
  modIndex      Int
  stage         Stage  @relation(fields: [tournamentId, stageNo], references: [tournamentId, stageNo], onDelete: Cascade)
}

model Registration {
  regId        BigInt     @id @default(autoincrement())
  tournamentId BigInt
  userId       Int
  tournament   Tournament @relation(fields: [tournamentId], references: [tournamentId], onDelete: Cascade)
}

enum Gamemode {
  STANDARD
  TAIKO
  CTB
  MANIA
}

enum MatchStatus {
  NOT_STARTED
  IN_PROGRESS
  PAUSED
  ENDED
}
